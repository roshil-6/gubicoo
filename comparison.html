<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <!-- Primary SEO Meta Tags -->
    <title>Compare AI Tools Side-by-Side - Gubicoo</title>
    <meta name="description" content="Compare AI tools side-by-side. See pricing, features, and differences to make the best choice for your needs." />
    <meta name="robots" content="index, follow" />
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="favicon/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="favicon/favicon.png" type="image/png" />
    <link rel="icon" href="icon/gubicoo-logo.png.png" type="image/png" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* INLINE CRITICAL MOBILE CSS - Works even if external CSS fails */
        @media (max-width: 768px) {
            .desktop-only { display: none !important; visibility: hidden !important; }
            .mobile-only { display: block !important; visibility: visible !important; }
            #mobileCompareWrapper { 
                display: block !important; 
                visibility: visible !important; 
                opacity: 1 !important; 
                width: 100% !important; 
            }
        }
        @media (min-width: 769px) {
            .mobile-only { display: none !important; }
            .desktop-only { display: block !important; }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="index.html" class="back-link">‚Üê Back</a>
            <h1 class="site-title">Compare AI Tools</h1>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <section id="compare-tools" class="compare-section">
                <h2 class="section-title">Compare AI Tools</h2>

                <!-- Desktop: Multi-tool comparison -->
                <div class="compare-controls desktop-only">
                    <div class="compare-selectors" id="toolSelectors">
                        <!-- Tool selectors will be added dynamically -->
                    </div>
                    <div class="compare-actions">
                        <button class="add-tool-btn" id="addToolBtn" title="Add another tool (max 5)">
                            <span class="material-symbols-outlined">add</span>
                            <span>Add Tool</span>
                        </button>
                    </div>
                </div>

                <!-- Desktop: Comparison table -->
                <div class="compare-table-wrapper desktop-only">
                    <table class="compare-table" id="compareTable">
                        <thead id="compareTableHead">
                            <tr>
                                <th>Feature</th>
                                <!-- Tool headers will be added dynamically -->
                            </tr>
                        </thead>
                        <tbody id="compareBody">
                            <tr>
                                <td colspan="2" class="compare-placeholder">
                                    <div class="placeholder-content">
                                        <span class="material-symbols-outlined">compare_arrows</span>
                                        <p>Select at least two tools to compare</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Mobile: Simple two-tool comparison -->
                <div class="mobile-compare-wrapper mobile-only" id="mobileCompareWrapper">
                    <div class="mobile-compare-selectors">
                        <div class="mobile-selector-group">
                            <label for="mobileToolA">Select Tool A</label>
                            <select id="mobileToolA" class="mobile-tool-select">
                                <option value="">Choose a tool...</option>
                            </select>
                        </div>
                        <div class="mobile-selector-group">
                            <label for="mobileToolB">Select Tool B</label>
                            <select id="mobileToolB" class="mobile-tool-select">
                                <option value="">Choose a tool...</option>
                            </select>
                        </div>
                    </div>

                    <div id="mobileComparisonResult" class="mobile-comparison-result">
                        <p class="mobile-placeholder">Select both tools to compare</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 gubicoo Lens. Honest comparisons, no fluff.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="settings.js"></script>
    <script>
        // BULLETPROOF mobile detection and visibility for REAL devices
        (function() {
            function isMobileDevice() {
                // Multiple detection methods - be VERY aggressive for real devices
                const width = window.innerWidth || document.documentElement.clientWidth || screen.width || 0;
                const mediaQuery = window.matchMedia('(max-width: 768px)');
                const userAgent = navigator.userAgent || '';
                const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
                const touchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                
                // VERY aggressive: If width <= 768 OR media query matches OR (mobile UA and width < 1024) OR (touch and width <= 1024)
                return width <= 768 || mediaQuery.matches || (isMobileUA && width < 1024) || (touchDevice && width <= 1024);
            }
            
            function showMobileInterface() {
                const mobileWrapper = document.getElementById('mobileCompareWrapper');
                const desktopElements = document.querySelectorAll('.desktop-only');
                const isMobile = isMobileDevice();
                
                // ALWAYS ensure mobile wrapper exists before checking
                if (!mobileWrapper) {
                    setTimeout(showMobileInterface, 100);
                    return;
                }
                
                if (isMobile) {
                    // FORCE show mobile with aggressive inline styles - NEVER hide on mobile
                    mobileWrapper.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; width: 100% !important; max-width: 100% !important; position: relative !important; z-index: 1000 !important; padding: 1rem !important; box-sizing: border-box !important; margin: 0 !important;';
                    
                    // Also force visibility on child elements
                    const selectors = mobileWrapper.querySelector('.mobile-compare-selectors');
                    const result = mobileWrapper.querySelector('.mobile-comparison-result');
                    if (selectors) selectors.style.cssText = 'display: flex !important; visibility: visible !important;';
                    if (result) result.style.cssText = 'display: flex !important; visibility: visible !important;';
                    
                    // FORCE hide desktop
                    desktopElements.forEach(function(el) {
                        el.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important; height: 0 !important; overflow: hidden !important;';
                    });
                } else {
                    // Only hide mobile on desktop (width > 768px)
                    mobileWrapper.style.cssText = 'display: none !important; visibility: hidden !important;';
                    // Show desktop
                    desktopElements.forEach(function(el) {
                        el.style.cssText = '';
                    });
                }
            }
            
            // Run immediately (before DOM ready) - CRITICAL for real devices
            setTimeout(showMobileInterface, 0);
            
            // Run when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', showMobileInterface);
            } else {
                showMobileInterface();
            }
            
            // Run after window fully loads (critical for real devices with slow connections)
            window.addEventListener('load', function() {
                setTimeout(showMobileInterface, 0);
                setTimeout(showMobileInterface, 50);
                setTimeout(showMobileInterface, 200);
                setTimeout(showMobileInterface, 500);
                setTimeout(showMobileInterface, 1000);
            });
            
            // Run on resize and orientation change
            window.addEventListener('resize', function() {
                setTimeout(showMobileInterface, 0);
                setTimeout(showMobileInterface, 100);
            });
            
            window.addEventListener('orientationchange', function() {
                setTimeout(showMobileInterface, 0);
                setTimeout(showMobileInterface, 300);
                setTimeout(showMobileInterface, 600);
            });
        })();

        // Initialize comparison page - MULTIPLE attempts for real devices
        function runInit() {
            initComparisonPage();
        }
        
        // Try immediately if DOM is ready
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            runInit();
        }
        
        // Try on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', runInit);
        
        // Try on window load (critical for real devices with slow connections)
        window.addEventListener('load', function() {
            setTimeout(runInit, 50);
            setTimeout(runInit, 200);
            setTimeout(runInit, 500);
            setTimeout(runInit, 1000);
        });
        
        // Last resort - try after 2 seconds and 5 seconds (for very slow devices)
        setTimeout(runInit, 2000);
        setTimeout(runInit, 5000);
        
        // Also ensure mobile is visible on every frame for first 3 seconds (for real devices)
        let frameCount = 0;
        const maxFrames = 60; // ~3 seconds at 20fps
        function forceMobileVisible() {
            if (frameCount++ < maxFrames) {
                const mobileWrapper = document.getElementById('mobileCompareWrapper');
                if (mobileWrapper) {
                    const width = window.innerWidth || document.documentElement.clientWidth || screen.width || 0;
                    if (width <= 768 || window.matchMedia('(max-width: 768px)').matches) {
                        mobileWrapper.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; width: 100% !important;';
                    }
                }
                requestAnimationFrame(forceMobileVisible);
            }
        }
        requestAnimationFrame(forceMobileVisible);

        function initComparisonPage() {
            // Use same detection as visibility function
            function isMobile() {
                const width = window.innerWidth || document.documentElement.clientWidth || screen.width;
                const mediaQuery = window.matchMedia('(max-width: 768px)');
                const userAgent = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                return mediaQuery.matches || width <= 768 || (userAgent && width < 1024);
            }
            
            const isMobileDevice = isMobile();
            
            // Always try mobile initialization (it will work or fail gracefully)
            initMobileComparison();
            
            // Initialize desktop only if not mobile
            if (!isMobileDevice) {
                initDesktopComparison();
            }
        }

        function loadData() {
            return fetch('tools-data.json')
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load data');
                    }
                    return response.json();
                })
                .catch(function(error) {
                    console.error('[COMPARISON] Error loading data:', error);
                    return null;
                });
        }

        function initMobileComparison() {
            const toolA = document.getElementById('mobileToolA');
            const toolB = document.getElementById('mobileToolB');
            const resultDiv = document.getElementById('mobileComparisonResult');
            const mobileWrapper = document.getElementById('mobileCompareWrapper');
            
            if (!toolA || !toolB || !resultDiv) {
                // Retry multiple times for real devices (more attempts)
                setTimeout(initMobileComparison, 50);
                setTimeout(initMobileComparison, 200);
                setTimeout(initMobileComparison, 500);
                setTimeout(initMobileComparison, 1000);
                setTimeout(initMobileComparison, 2000);
                return;
            }
            
            // FORCE visibility on mobile (aggressive) - ALWAYS check and force
            if (mobileWrapper) {
                const width = window.innerWidth || document.documentElement.clientWidth || screen.width || 0;
                const mediaQuery = window.matchMedia('(max-width: 768px)');
                const isMobile = width <= 768 || mediaQuery.matches;
                
                if (isMobile) {
                    // Force visibility with ALL possible properties
                    mobileWrapper.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; width: 100% !important; max-width: 100% !important; padding: 1rem !important; box-sizing: border-box !important; position: relative !important; z-index: 1000 !important; margin: 0 !important;';
                    
                    // Also ensure child elements are visible
                    const children = mobileWrapper.querySelectorAll('*');
                    children.forEach(function(child) {
                        if (child.style) {
                            child.style.visibility = 'visible';
                            child.style.opacity = '1';
                        }
                    });
                }
            }
            
            // Load tools data with retry
            loadData()
                .then(function(data) {
                    if (!data || !data.tools || data.tools.length === 0) {
                        resultDiv.innerHTML = '<p class="mobile-placeholder">No tools available. Please refresh the page.</p>';
                        return;
                    }

                    // Clear and populate dropdowns
                    toolA.innerHTML = '<option value="">Choose a tool...</option>';
                    toolB.innerHTML = '<option value="">Choose a tool...</option>';
                    
                    data.tools.forEach(function(tool) {
                        if (tool && tool.id && tool.name) {
                            const optionA = document.createElement('option');
                            optionA.value = tool.id;
                            optionA.textContent = tool.name;
                            toolA.appendChild(optionA);
                            
                            const optionB = document.createElement('option');
                            optionB.value = tool.id;
                            optionB.textContent = tool.name;
                            toolB.appendChild(optionB);
                        }
                    });

                    // Store data globally for comparison
                    window.mobileComparisonData = data;

                    // Handle selection changes
                    function updateComparison() {
                        renderMobileComparison(data);
                    }
                    
                    toolA.removeEventListener('change', updateComparison);
                    toolB.removeEventListener('change', updateComparison);
                    toolA.addEventListener('change', updateComparison);
                    toolB.addEventListener('change', updateComparison);
                })
                .catch(function(error) {
                    resultDiv.innerHTML = '<p class="mobile-placeholder">Failed to load tools. Please check your connection and refresh.</p>';
                    // Retry after 2 seconds
                    setTimeout(initMobileComparison, 2000);
                });
        }

        function initDesktopComparison() {
            console.log('[DESKTOP COMPARISON] Initializing desktop comparison');
            // Desktop comparison logic (existing code)
            if (typeof loadMultiToolComparison === 'function') {
                loadMultiToolComparison();
            }
        }

        function renderMobileComparison(data) {
            const toolAEl = document.getElementById('mobileToolA');
            const toolBEl = document.getElementById('mobileToolB');
            const resultDiv = document.getElementById('mobileComparisonResult');
            
            if (!toolAEl || !toolBEl || !resultDiv) {
                return;
            }
            
            const toolAId = toolAEl.value;
            const toolBId = toolBEl.value;

            if (!toolAId || !toolBId) {
                resultDiv.innerHTML = '<p class="mobile-placeholder">Select both tools to compare</p>';
                return;
            }
            
            // Use stored data if available
            if (!data && window.mobileComparisonData) {
                data = window.mobileComparisonData;
            }
            
            if (!data || !data.tools) {
                resultDiv.innerHTML = '<p class="mobile-placeholder">Data not available. Please refresh.</p>';
                return;
            }

            const toolA = data.tools.find(function(t) { return t && t.id === toolAId; });
            const toolB = data.tools.find(function(t) { return t && t.id === toolBId; });

            if (!toolA || !toolB) {
                resultDiv.innerHTML = '<p class="mobile-placeholder">Tools not found</p>';
                return;
            }

            // Render comparison
            resultDiv.innerHTML = `
                <div class="mobile-tool-section">
                    <h3 class="mobile-tool-name">${escapeHtml(toolA.name)}</h3>
                    <div class="mobile-tool-info">
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Category:</span>
                            <span class="mobile-info-value">${escapeHtml(toolA.categoryName || getCategoryName(data, toolA.category) || 'N/A')}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Description:</span>
                            <span class="mobile-info-value">${escapeHtml(toolA.purpose || toolA.description || 'N/A')}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Pricing:</span>
                            <span class="mobile-info-value">${escapeHtml(getPricingType(toolA))}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Key Features:</span>
                            <span class="mobile-info-value">${getKeyFeatures(toolA)}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Should I Pay?</span>
                            <span class="mobile-info-value verdict">${escapeHtml(toolA.shouldIPay || 'N/A')}</span>
                        </div>
                    </div>
                </div>
                <div class="mobile-tool-section">
                    <h3 class="mobile-tool-name">${escapeHtml(toolB.name)}</h3>
                    <div class="mobile-tool-info">
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Category:</span>
                            <span class="mobile-info-value">${escapeHtml(toolB.categoryName || getCategoryName(data, toolB.category) || 'N/A')}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Description:</span>
                            <span class="mobile-info-value">${escapeHtml(toolB.purpose || toolB.description || 'N/A')}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Pricing:</span>
                            <span class="mobile-info-value">${escapeHtml(getPricingType(toolB))}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Key Features:</span>
                            <span class="mobile-info-value">${getKeyFeatures(toolB)}</span>
                        </div>
                        <div class="mobile-info-item">
                            <span class="mobile-info-label">Should I Pay?</span>
                            <span class="mobile-info-value verdict">${escapeHtml(toolB.shouldIPay || 'N/A')}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function getCategoryName(data, categoryId) {
            if (!data || !data.categories) return null;
            const category = data.categories.find(cat => cat && cat.id === categoryId);
            return category ? category.name : null;
        }

        function getPricingType(tool) {
            if (tool.pricingType) return tool.pricingType;
            if (tool.pricing) {
                if (tool.pricing.free && tool.pricing.free.available) {
                    return tool.pricing.paid ? 'Freemium' : 'Free';
                }
                return 'Paid';
            }
            return 'N/A';
        }

        function getKeyFeatures(tool) {
            if (tool.bestFor && Array.isArray(tool.bestFor) && tool.bestFor.length > 0) {
                return tool.bestFor.slice(0, 5).map(item => escapeHtml(item)).join(', ');
            }
            return 'N/A';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
